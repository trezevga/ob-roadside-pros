<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OB Roadside Pros â€” Request Help</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#CC5500" />
  <link rel="icon" sizes="192x192" href="./icon-192.png" />
  <style>
    :root { --burnt-orange: #CC5500; --black: #000000; --smoke-grey: #888B8D; }
    html, body { height: 100%; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; background: var(--black); color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; }
    header { position: sticky; top: 0; width: 100%; background: var(--burnt-orange); color: #fff; padding: 14px 16px; font-size: 1.4rem; font-weight: 800; box-shadow: 0 2px 8px rgba(0,0,0,.4); text-align: center; }
    .wrap { width: 100%; max-width: 720px; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .card { background: #0c0c0c; border: 1px solid #1f1f1f; border-radius: 14px; padding: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.35); }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btn { display: flex; align-items: center; justify-content: center; padding: 14px; border-radius: 12px; border: 1px solid #2a2a2a; background: #121212; color: #fff; text-decoration: none; font-weight: 700; transition: transform .15s ease, box-shadow .2s ease, background .2s ease; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,.35); }
    .btn.accent { background: var(--burnt-orange); border-color: #8a3a00; }
    .btn.grey   { background: #1a1a1a; border-color: #2a2a2a; color: var(--smoke-grey); }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    label { font-size: 13px; color: var(--smoke-grey); }
    input, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #2a2a2a; background: #0b0b0b; color: #fff; }
    .muted { color: var(--smoke-grey); font-size: 13px; }
    .pill { font-size: 12px; border: 1px solid #2a2a2a; padding: 4px 8px; border-radius: 999px; color: var(--smoke-grey); }
    .link { color: #ffd7bf; text-decoration: underline; }
    .hidden { display:none; }
    .ok { color:#7CFC7C }
    .err { color:#ff6b6b }
  </style>
</head>
<body>
  <header>ğŸš¨ OB Roadside Pros</header>
  <div class="wrap">

    <section class="card" id="servicesCard">
      <div class="row" style="justify-content:space-between;align-items:center">
        <strong>What do you need?</strong>
        <span class="pill">Open 6pmâ€“2am Sunâ€“Wed â€¢ Thuâ€“Sat after 7am</span>
      </div>
      <div class="grid" style="margin-top:10px">
        <button class="btn accent" data-service="Lockout">ğŸ”‘ Lockout</button>
        <button class="btn" data-service="Fuel Delivery">â›½ Fuel Delivery</button>
        <button class="btn" data-service="Jump Start">ğŸ”‹ Jump Start</button>
        <button class="btn" data-service="Tire Change">ğŸ› Tire Change</button>
        <button class="btn grey" data-service="Other">ğŸ“¦ Other</button>
        <a class="btn" href="tel:+19017452474">ğŸ“ Call Now</a>
      </div>
      <div class="muted" style="margin-top:8px">Prefer to talk first? Tap <a class="link" href="tel:+19017452474">Call Now</a> or <a class="link" id="smsQuick" href="#">Text Us</a>.</div>
    </section>

    <section class="card" id="locationCard">
      <strong>Where are you?</strong>
      <div class="row" style="margin-top:8px">
        <button id="useLocation" class="btn accent" style="flex:1">ğŸ“ Use My Location</button>
        <button id="copyMaps" class="btn" style="flex:1">ğŸ“ Copy Google Maps Link</button>
      </div>
      <div id="locStatus" class="muted" style="margin-top:8px">Location not set.</div>
      <div id="locData" class="muted hidden" style="margin-top:6px"></div>
    </section>

    <section class="card" id="detailsCard">
      <strong>Contact & Details</strong>
      <div class="row" style="margin-top:8px">
        <div style="flex:1">
          <label>Your Name</label>
          <input id="name" placeholder="First & last name" autocomplete="name" />
        </div>
        <div style="flex:1">
          <label>Your Phone</label>
          <input id="phone" placeholder="5551234567" inputmode="tel" autocomplete="tel" />
        </div>
      </div>
      <div style="margin-top:8px">
        <label>Notes (vehicle, color, plate, special spot)</label>
        <textarea id="notes" rows="3" placeholder="Silver Camry, shoulder of Iâ€‘240, exit 20A"></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="requestBtn" class="btn accent" style="flex:2">ğŸš€ Request Service</button>
        <a id="callBtn" class="btn" style="flex:1" href="tel:+19017452474">ğŸ“ Call</a>
        <a id="textBtn" class="btn" style="flex:1" href="#">ğŸ’¬ Text</a>
      </div>
      <div class="muted" style="margin-top:8px">Weâ€™ll confirm your rate and send an ETA.</div>
      <div id="submitStatus" class="muted" style="margin-top:8px"></div>
    </section>

  </div>

  <!-- Hidden form (Web3Forms) -->
  <iframe name="hidden_iframe" style="display:none"></iframe>
  <form id="backendForm" class="hidden" action="https://api.web3forms.com/submit" method="POST" target="hidden_iframe">
    <input type="hidden" name="access_key" value="PASTE_YOUR_WEB3FORMS_ACCESS_KEY_HERE" />
    <input type="hidden" name="subject" value="New Roadside Assistance Request" />
    <input type="hidden" name="from_name" value="OB Roadside Pros App" />
    <input type="hidden" name="message" id="f_message" />
  </form>

  <script>
  (function(){
    const E = id => document.getElementById(id);
    const selected = { service:null };
    const businessPhone = '+19017452474';
    const submitStatus = E('submitStatus');

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }

    document.querySelectorAll('[data-service]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        selected.service = btn.dataset.service;
        document.querySelectorAll('[data-service]').forEach(b=>b.style.outline='none');
        btn.style.outline='2px solid var(--burnt-orange)';
        toast(`Selected: ${selected.service}`);
      });
    });

    E('smsQuick').addEventListener('click', (e)=>{
      e.preventDefault(); openSMS('Hi, I need roadside assistance. Can you call me?');
    });

    let coords = null, accuracy = null;
    E('useLocation').addEventListener('click', ()=>{
      if (!('geolocation' in navigator)) { setStatus('Geolocation not supported.'); return; }
      setStatus('Getting locationâ€¦');
      navigator.geolocation.getCurrentPosition((pos)=>{
        coords = pos.coords; accuracy = Math.round(coords.accuracy);
        setStatus('Location captured âœ…');
        const link = mapsLink(coords.latitude, coords.longitude);
        const ld = E('locData'); ld.classList.remove('hidden');
        ld.innerHTML = `Lat: ${coords.latitude.toFixed(5)}, Lng: ${coords.longitude.toFixed(5)} â€¢ Accuracy ~ ${accuracy}m<br><a class="link" href="${link}" target="_blank">Open in Google Maps</a>`;
      }, (err)=>{
        setStatus('Could not get location: '+ err.message);
      }, { enableHighAccuracy:true, maximumAge:10000, timeout:15000 });
    });

    E('copyMaps').addEventListener('click', async ()=>{
      if (!coords) { toast('Tap "Use My Location" first'); return; }
      const link = mapsLink(coords.latitude, coords.longitude);
      try { await navigator.clipboard.writeText(link); toast('Google Maps link copied'); }
      catch(e){ toast('Copy failed â€” longâ€‘press to copy'); }
    });

    function setStatus(msg){ E('locStatus').textContent = msg; }
    function mapsLink(lat,lng){ return `https://maps.google.com/?q=${lat},${lng}`; }

    function buildMessage(){
      const name = (E('name')?.value || '').trim();
      const phone = (E('phone')?.value || '').trim();
      const notes = (E('notes')?.value || '').trim();
      const svc = selected.service || 'Roadside Assistance';
      const loc = coords ? `\nLocation: ${coords.latitude.toFixed(5)}, ${coords.longitude.toFixed(5)} (Â±${accuracy}m)\nMaps: ${mapsLink(coords.latitude, coords.longitude)}` : '\nLocation: (not shared)';
      const ua = navigator.userAgent;
      return `Service: ${svc}\nName: ${name||'(not given)'}\nPhone: ${phone||'(not given)'}\nNotes: ${notes||'(none)'}${loc}\nUserAgent: ${ua}`;
    }

    function openSMS(preset){
      const body = encodeURIComponent(preset || buildMessage());
      const href = `sms:${businessPhone}?&body=${body}`;
      window.location.href = href;
    }

    E('textBtn').addEventListener('click', (e)=>{ e.preventDefault(); openSMS(); });
    E('callBtn').setAttribute('href', `tel:${businessPhone}`);
    E('requestBtn').addEventListener('click', ()=>{
      if (!selected.service) { toast('Pick a service first'); return; }
      submitStatus.textContent = 'Submittingâ€¦';
      E('f_message').value = buildMessage();
      const needsKey = document.querySelector('input[name="access_key"]').value.includes('PASTE_YOUR_WEB3FORMS_ACCESS_KEY_HERE');
      if (needsKey){
        submitStatus.innerHTML = '<span class="err">Backend not configured yet. Tap Text to send manually, or add your Web3Forms access key.</span>';
        toast('Backend not set â€” using Text instead'); 
        openSMS(); 
        return;
      }
      document.getElementById('backendForm').submit();
      submitStatus.innerHTML = '<span class="ok">Request sent! We\'ll contact you shortly.</span>';
    });

    let toastEl = null; function toast(msg){
      if (!toastEl){ toastEl = document.createElement('div'); toastEl.style.position='fixed'; toastEl.style.left='50%'; toastEl.style.bottom='24px'; toastEl.style.transform='translateX(-50%)'; toastEl.style.background='#111'; toastEl.style.border='1px solid #2a2a2a'; toastEl.style.color='#fff'; toastEl.style.padding='10px 14px'; toastEl.style.borderRadius='10px'; toastEl.style.boxShadow='0 6px 18px rgba(0,0,0,0.35)'; document.body.appendChild(toastEl);} 
      toastEl.textContent = msg; toastEl.style.opacity='1';
      clearTimeout(toastEl._t); toastEl._t = setTimeout(()=> toastEl.style.opacity='0', 1800);
    }
  })();
  </script>
</body>
</html>
