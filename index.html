<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OB Roadside Pros ‚Äî Request Help</title>
  <!-- PWA hooks (expects these files already in your repo): manifest.json, service-worker.js, icons -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#CC5500" />
  <link rel="icon" sizes="192x192" href="./icon-192.png" />

  <style>
    :root {
      --burnt-orange: #CC5500;
      --black: #000000;
      --smoke-grey: #888B8D;
    }
    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background: var(--black);
      color: #fff;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      position: sticky; top: 0;
      width: 100%;
      background: var(--burnt-orange);
      color: #fff;
      padding: 14px 16px;
      font-size: 1.4rem;
      font-weight: 800;
      box-shadow: 0 2px 8px rgba(0,0,0,.4);
      text-align: center;
      z-index: 10;
    }
    .wrap { width: 100%; max-width: 720px; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .card { background: #0c0c0c; border: 1px solid #1f1f1f; border-radius: 14px; padding: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.35); }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btn { display: flex; align-items: center; justify-content: center; padding: 14px; border-radius: 12px; border: 1px solid #2a2a2a; background: #121212; color: #fff; text-decoration: none; font-weight: 700; transition: transform .15s ease, box-shadow .2s ease, background .2s ease; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,.35); }
    .btn.accent { background: var(--burnt-orange); border-color: #8a3a00; }
    .btn.grey   { background: #1a1a1a; border-color: #2a2a2a; color: var(--smoke-grey); }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    label { font-size: 13px; color: var(--smoke-grey); }
    input, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #2a2a2a; background: #0b0b0b; color: #fff; }
    .muted { color: var(--smoke-grey); font-size: 13px; }
    .pill { font-size: 12px; border: 1px solid #2a2a2a; padding: 4px 8px; border-radius: 999px; color: var(--smoke-grey); }
    .link { color: #ffd7bf; text-decoration: underline; }
    .hidden { display:none; }
    .ok { color:#7CFC7C }
    .err { color:#ff6b6b }

    /* Splash screen */
    .splash {
      position: fixed; inset: 0; z-index: 9999;
      display: grid; place-items: center;
      background: radial-gradient(1200px 800px at 50% 30%, rgba(204,85,0,0.25), transparent 60%),
                  linear-gradient(180deg, #000 0%, #0a0a0a 100%);
      transition: opacity .6s ease, transform .6s ease;
    }
    .splash__inner {
      display: grid; place-items: center; gap: 14px;
      transform: translateY(6px);
      animation: lift .8s ease forwards;
    }
    .logo-mark {
      width: 96px; height: 96px; border-radius: 22px;
      background: linear-gradient(135deg, var(--burnt-orange), #a94400 70%);
      box-shadow: 0 12px 28px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.06);
      display: grid; place-items: center;
    }
    .logo-mark__text {
      font-weight: 900; font-size: 30px; letter-spacing: .5px;
      color: var(--smoke-grey);
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
    }
    .brand-line { font-weight: 800; font-size: 18px; color: #fff; }
    .tagline { color: var(--smoke-grey); font-size: 13px; }
    .splash--hide { opacity: 0; transform: scale(.985); pointer-events: none; }
    @keyframes lift { from { transform: translateY(10px); opacity: .6; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>
  <!-- Splash -->
  <div id="app-splash" class="splash">
    <div class="splash__inner">
      <div class="logo-mark"><div class="logo-mark__text">OB</div></div>
      <div class="brand-line">OB Roadside Pros</div>
      <div class="tagline">Fast ‚Ä¢ Reliable ‚Ä¢ Local</div>
    </div>
  </div>

  <header>üö® OB Roadside Pros</header>
  <div class="wrap">

    <section class="card" id="servicesCard">
      <div class="row" style="justify-content:space-between;align-items:center">
        <strong>What do you need?</strong>
        <span class="pill">Open 6pm‚Äì2am Sun‚ÄìWed ‚Ä¢ Thu‚ÄìSat after 7am</span>
      </div>
      <div class="grid" style="margin-top:10px">
        <button class="btn accent" data-service="Lockout">üîë Lockout</button>
        <button class="btn" data-service="Fuel Delivery">‚õΩ Fuel Delivery</button>
        <button class="btn" data-service="Jump Start">üîã Jump Start</button>
        <button class="btn" data-service="Tire Change">üõû Tire Change</button>
        <button class="btn grey" data-service="Other">üì¶ Other</button>
        <a class="btn" href="tel:+19017452474">üìû Call Now</a>
      </div>
      <div class="muted" style="margin-top:8px">Prefer to talk first? Tap <a class="link" href="tel:+19017452474">Call Now</a> or <a class="link" id="smsQuick" href="#">Text Us</a>.</div>
    </section>

    <section class="card" id="locationCard">
      <strong>Where are you?</strong>
      <div class="row" style="margin-top:8px">
        <button id="useLocation" class="btn accent" style="flex:1">üìç Use My Location</button>
        <button id="copyMaps" class="btn" style="flex:1">üìé Copy Google Maps Link</button>
      </div>
      <div id="locStatus" class="muted" style="margin-top:8px">Location not set.</div>
      <div id="locData" class="muted hidden" style="margin-top:6px"></div>
    </section>

    <section class="card" id="detailsCard">
      <strong>Contact & Details</strong>
      <div class="row" style="margin-top:8px">
        <div style="flex:1">
          <label>Your Name</label>
          <input id="name" placeholder="First & last name" autocomplete="name" />
        </div>
        <div style="flex:1">
          <label>Your Phone</label>
          <input id="phone" placeholder="5551234567" inputmode="tel" autocomplete="tel" />
        </div>
      </div>
      <div style="margin-top:8px">
        <label>Notes (vehicle, color, plate, special spot)</label>
        <textarea id="notes" rows="3" placeholder="Silver Camry, shoulder of I-240, exit 20A"></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="requestBtn" class="btn accent" style="flex:2">üöÄ Request Service</button>
        <a id="callBtn" class="btn" style="flex:1" href="tel:+19017452474">üìû Call</a>
        <a id="textBtn" class="btn" style="flex:1" href="#">üí¨ Text</a>
      </div>
      <div class="muted" style="margin-top:8px">We‚Äôll confirm your rate and send an ETA.</div>
      <div id="submitStatus" class="muted" style="margin-top:8px"></div>
    </section>

  </div>

  <!-- Hidden form (Web3Forms) -->
<iframe name="hidden_iframe" style="display:none"></iframe>
  <form id="backendForm" class="hidden" action="https://api.web3forms.com/submit" method="POST" target="hidden_iframe">
    <input type="hidden" name="access_key" value="621f8953-e894-44de-9178-db262a3b3442" />
    <input type="hidden" name="subject" value="New Roadside Assistance Request" />
    <input type="hidden" name="from_name" value="OB Roadside Pros App" />
    <input type="hidden" name="message" id="f_message" />
  </form>
  
  <script>
  (function(){
    const E = id => document.getElementById(id);
    const selected = { service:null };
    const businessPhone = '+19017452474';
    const submitStatus = E('submitStatus');

    // Service worker registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }

    // Splash control: hide after first render or 1.2s, whichever is later
    (function(){
      const splash = document.getElementById('app-splash');
      const MIN_TIME = 1200;
      const start = performance.now();
      function hideSplash() {
        if (!splash) return;
        const elapsed = performance.now() - start;
        const wait = Math.max(0, MIN_TIME - elapsed);
        setTimeout(() => splash.classList.add('splash--hide'), wait);
        splash.addEventListener('transitionend', () => splash.remove(), { once: true });
      }
      if (document.readyState === 'complete') hideSplash();
      else window.addEventListener('load', hideSplash);
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.ready.then(hideSplash).catch(()=>{});
      }
    })();

    // Service selection
    document.querySelectorAll('[data-service]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        selected.service = btn.dataset.service;
        document.querySelectorAll('[data-service]').forEach(b=>b.style.outline='none');
        btn.style.outline='2px solid var(--burnt-orange)';
        toast(`Selected: ${selected.service}`);
      });
    });

    // Quick SMS link
    const smsQuick = document.getElementById('smsQuick');
    if (smsQuick) {
      smsQuick.addEventListener('click', (e)=>{
        e.preventDefault(); openSMS('Hi, I need roadside assistance. Can you call me?');
      });
    }

    // Geolocation
    let coords = null, accuracy = null;
    E('useLocation').addEventListener('click', ()=>{
      if (!('geolocation' in navigator)) { setStatus('Geolocation not supported.'); return; }
      setStatus('Getting location‚Ä¶');
      navigator.geolocation.getCurrentPosition((pos)=>{
        coords = pos.coords; accuracy = Math.round(coords.accuracy);
        setStatus('Location captured ‚úÖ');
        const link = mapsLink(coords.latitude, coords.longitude);
        const ld = E('locData'); ld.classList.remove('hidden');
        ld.innerHTML = `Lat: ${coords.latitude.toFixed(5)}, Lng: ${coords.longitude.toFixed(5)} ‚Ä¢ Accuracy ~ ${accuracy}m<br><a class="link" href="${link}" target="_blank">Open in Google Maps</a>`;
      }, (err)=>{
        setStatus('Could not get location: '+ err.message);
      }, { enableHighAccuracy:true, maximumAge:10000, timeout:15000 });
    });

    E('copyMaps').addEventListener('click', async ()=>{
      if (!coords) { toast('Tap "Use My Location" first'); return; }
      const link = mapsLink(coords.latitude, coords.longitude);
      try { await navigator.clipboard.writeText(link); toast('Google Maps link copied'); }
      catch(e){ toast('Copy failed ‚Äî long-press to copy'); }
    });

    function setStatus(msg){ const el = E('locStatus'); if (el) el.textContent = msg; }
    function mapsLink(lat,lng){ return `https://maps.google.com/?q=${lat},${lng}`; }

    // Compose message body
    function buildMessage(){
      const name = (E('name')?.value || '').trim();
      const phone = (E('phone')?.value || '').trim();
      const notes = (E('notes')?.value || '').trim();
      const svc = selected.service || 'Roadside Assistance';
      const loc = coords ? `\nLocation: ${coords.latitude.toFixed(5)}, ${coords.longitude.toFixed(5)} (¬±${accuracy}m)\nMaps: ${mapsLink(coords.latitude, coords.longitude)}` : '\nLocation: (not shared)';
      const ua = navigator.userAgent;
      return `Service: ${svc}\nName: ${name||'(not given)'}\nPhone: ${phone||'(not given)'}\nNotes: ${notes||'(none)'}${loc}\nUserAgent: ${ua}`;
    }

    function openSMS(preset){
      const body = encodeURIComponent(preset || buildMessage());
      const href = `sms:${businessPhone}?&body=${body}`;
      window.location.href = href;
    }

    // Buttons
    E('textBtn').addEventListener('click', (e)=>{ e.preventDefault(); openSMS(); });
    E('callBtn').setAttribute('href', `tel:${businessPhone}`);
    E('requestBtn').addEventListener('click', ()=>{
      if (!selected.service) { toast('Pick a service first'); return; }
      submitStatus.textContent = 'Submitting‚Ä¶';
      E('f_message').value = buildMessage();
      const needsKey = document.querySelector('input[name="access_key"]').value.includes('621f8953-e894-44de-9178-db262a3b3442');
      if (needsKey){
        submitStatus.innerHTML = '<span class="err">Backend not configured yet. Tap Text to send manually, or add your Web3Forms access key.</span>';
        toast('Backend not set ‚Äî using Text instead'); 
        openSMS(); 
        return;
      }
      document.getElementById('backendForm').submit();
      submitStatus.innerHTML = '<span class="ok">Request sent! We\'ll contact you shortly.</span>';
    });

    // Toast helper
    let toastEl = null; function toast(msg){
      if (!toastEl){ toastEl = document.createElement('div'); toastEl.style.position='fixed'; toastEl.style.left='50%'; toastEl.style.bottom='24px'; toastEl.style.transform='translateX(-50%)'; toastEl.style.background='#111'; toastEl.style.border='1px solid #2a2a2a'; toastEl.style.color='#fff'; toastEl.style.padding='10px 14px'; toastEl.style.borderRadius='10px'; toastEl.style.boxShadow='0 6px 18px rgba(0,0,0,0.35)'; document.body.appendChild(toastEl);} 
      toastEl.textContent = msg; toastEl.style.opacity='1';
      clearTimeout(toastEl._t); toastEl._t = setTimeout(()=> toastEl.style.opacity='0', 1800);
    }
  })();
  </script>
</body>
</html>
